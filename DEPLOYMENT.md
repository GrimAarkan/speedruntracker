# Deployment Guide for Outlast Speedrun Tracker

This application can be deployed on Render.com. Follow these instructions to deploy successfully.

## Prerequisites

- A Render.com account
- A GitHub account with a repository for the application
- GitHub Personal Access Token with repo permissions for automatic record archiving

## Deployment Steps on Render

1. Log in to your Render.com account
2. Select "New Web Service"
3. Connect to your GitHub repository containing the application code
4. Use the following configuration settings:

### Basic Configuration
- **Name**: outlast-speedrun-tracker (or your preferred name)
- **Environment**: Python
- **Region**: Choose the region closest to your users

### Build and Start Commands
```
Build Command: pip install -r requirements-render.txt
Start Command: gunicorn main:app --bind 0.0.0.0:$PORT
```

### Environment Variables
Set up the following environment variables:
- `PYTHON_VERSION`: 3.11.0
- `SESSION_SECRET`: (Auto-generated by Render)
- `GITHUB_TOKEN`: Your GitHub Personal Access Token
- `GITHUB_REPO_OWNER`: Your GitHub username (e.g., GrimAarkan)
- `GITHUB_REPO_NAME`: Your repository name (e.g., speedruntracker)

### Advanced Settings
- **Health Check Path**: /
- **Auto-Deploy**: Yes (or your preference)

## Important Files

1. **requirements-render.txt**: This file contains all the dependencies needed to run the application on Render. Make sure it includes:
```
flask==2.3.3
flask-sqlalchemy==3.1.1
gunicorn==23.0.0
psycopg2-binary==2.9.9
requests==2.31.0
email-validator==2.1.0
```

2. **main.py**: This should contain your app instance that is imported by gunicorn.

## Troubleshooting

### Poetry Issues
If you see errors related to Poetry during deployment:
- Render by default tries to use Poetry if it detects a `pyproject.toml` file
- To force Render to use pip instead, specify the build command explicitly as shown above

### Dependency Issues
If the application is failing to start due to missing dependencies:
- Check that all dependencies are correctly listed in `requirements-render.txt`
- Make sure the Python version specified in the environment variables is compatible with your dependencies

### GitHub Integration Issues
If the GitHub integration is not working:
- Verify that the `GITHUB_TOKEN` environment variable is correctly set
- Check that the token has the necessary permissions
- Ensure that the repository owner and name are correctly specified

## Setting Up Render Cron Jobs for Automatic GitHub Exports

The free tier of Render will spin down your web service after periods of inactivity, which can interrupt the background threads that handle automatic GitHub exports. To ensure that records are still regularly pushed to GitHub, you can use Render's Cron Jobs feature:

1. Log in to your Render Dashboard
2. Navigate to "Cron Jobs" section
3. Click "New Cron Job"
4. Set up the following:
   - **Name**: outlast-github-export
   - **Schedule**: `0 */6 * * *` (this runs every 6 hours)
   - **Command**: `curl -X POST https://your-app-name.onrender.com/api/cron/export-to-github`
   - **Region**: Choose the same region as your web service

This will trigger the special endpoint we've created that exports and pushes the latest records for all three games (Outlast, Whistleblower, and Outlast 2) to GitHub, even when your application is spun down.

### Render.yaml Cron Configuration
Alternatively, you can add the cron job configuration to your render.yaml file:

```yaml
services:
  - type: web
    name: outlast-speedrun-tracker
    # ... other web service configuration ...

  - type: cron
    name: github-export-records
    env: python
    schedule: "0 */6 * * *"
    buildCommand: echo "No build needed for cron job"
    startCommand: curl -X POST https://outlast-speedrun-tracker.onrender.com/api/cron/export-to-github
    envVars:
      - fromService:
          type: web
          name: outlast-speedrun-tracker
          envVarKey: GITHUB_TOKEN
```

### Render Cron Job Troubleshooting
If the cron job is not working:
- Verify that your web service is properly configured and accessible
- Check the cron job logs in the Render dashboard
- Ensure the URL in the command points to your actual deployed application
- Make sure the endpoint is publicly accessible (no authentication required)

## Setting Up Render Cron Jobs for Automatic GitHub Exports

The free tier of Render will spin down your web service after periods of inactivity, which can interrupt the background threads that handle automatic GitHub exports. To ensure that records are still regularly pushed to GitHub, you can use Render's Cron Jobs feature:

1. Log in to your Render Dashboard
2. Navigate to "Cron Jobs" section
3. Click "New Cron Job"
4. Set up the following:
   - **Name**: outlast-github-export
   - **Schedule**: `0 */6 * * *` (this runs every 6 hours)
   - **Command**: `curl -X POST https://your-app-name.onrender.com/api/cron/export-to-github`
   - **Region**: Choose the same region as your web service

This will trigger the special endpoint we've created that exports and pushes the latest records for all three games (Outlast, Whistleblower, and Outlast 2) to GitHub, even when your application is spun down.

### Render Cron Job Troubleshooting
If the cron job is not working:
- Verify that your web service is properly configured and accessible
- Check the cron job logs in the Render dashboard
- Ensure the URL in the command points to your actual deployed application
- Make sure the endpoint is publicly accessible (no authentication required)

## Setting Up Render Cron Jobs for Automatic GitHub Exports

The free tier of Render will spin down your web service after periods of inactivity, which can interrupt the background threads that handle automatic GitHub exports. To ensure that records are still regularly pushed to GitHub, you can use Render's Cron Jobs feature:

1. Log in to your Render Dashboard
2. Navigate to "Cron Jobs" section
3. Click "New Cron Job"
4. Set up the following:
   - **Name**: outlast-github-export
   - **Schedule**: `0 */6 * * *` (this runs every 6 hours)
   - **Command**: `curl -X POST https://your-app-name.onrender.com/api/cron/export-to-github`
   - **Region**: Choose the same region as your web service

This will trigger the special endpoint we've created that exports and pushes the latest records for all three games (Outlast, Whistleblower, and Outlast 2) to GitHub, even when your application is spun down.

### Render Cron Job Troubleshooting
If the cron job is not working:
- Verify that your web service is properly configured and accessible
- Check the cron job logs in the Render dashboard
- Ensure the URL in the command points to your actual deployed application
- Make sure the endpoint is publicly accessible (no authentication required)
## Setting Up Render Cron Jobs for Automatic GitHub Exports

The free tier of Render will spin down your web service after periods of inactivity, which can interrupt the background threads that handle automatic GitHub exports. To ensure that records are still regularly pushed to GitHub, you can use Render's Cron Jobs feature:

1. Log in to your Render Dashboard
2. Navigate to "Cron Jobs" section
3. Click "New Cron Job"
4. Set up the following:
   - **Name**: outlast-github-export
   - **Schedule**: `0 */6 * * *` (this runs every 6 hours)
   - **Command**: `curl -X POST https://your-app-name.onrender.com/api/cron/export-to-github`
   - **Region**: Choose the same region as your web service

This will trigger the special endpoint we've created that exports and pushes the latest records for all three games (Outlast, Whistleblower, and Outlast 2) to GitHub, even when your application is spun down.

### Render.yaml Cron Configuration
Alternatively, you can add the cron job configuration to your render.yaml file:

```yaml
services:
  - type: web
    name: outlast-speedrun-tracker
    # ... other web service configuration ...

  - type: cron
    name: github-export-records
    env: python
    schedule: "0 */6 * * *"
    buildCommand: echo "No build needed for cron job"
    startCommand: curl -X POST https://outlast-speedrun-tracker.onrender.com/api/cron/export-to-github
    envVars:
      - fromService:
          type: web
          name: outlast-speedrun-tracker
          envVarKey: GITHUB_TOKEN
```

### Render Cron Job Troubleshooting
If the cron job is not working:
- Verify that your web service is properly configured and accessible
- Check the cron job logs in the Render dashboard
- Ensure the URL in the command points to your actual deployed application
- Make sure the endpoint is publicly accessible (no authentication required)
